(function(){"use strict";function g(l,e,t,s,o,p,f,v){var _=typeof l=="function"?l.options:l;return e&&(_.render=e,_.staticRenderFns=t,_._compiled=!0),{exports:l,options:_}}const I={extends:"k-writer-field"};var L=function(){var e=this,t=e._self._c;return t("k-field",e._b({class:["k-writer-field",e.$attrs.class],style:e.$attrs.style,attrs:{counter:e.counterOptions,input:e.id}},"k-field",e.$props,!1),[t("k-input",e._b({ref:"input",attrs:{after:e.after,before:e.before,icon:e.icon,type:"seo-writer"},on:{input:function(s){return e.$emit("input",s)}}},"k-input",e.$props,!1))],1)},V=[],H=g(I,L,V);const N=H.exports;var F=g({extends:"k-writer-input",methods:{createNodes(){return Vue.component("k-writer-input").options.methods.createNodes.call(this).filter(e=>e.name!=="hardBreak")}}},null,null);const M=F.exports,n=window.Vue;function b(){return window.panel}function U(){return b().api}function A(){return b().app}function $(){const l=U();return{load:({parent:t,name:s})=>l.get(`${t}/sections/${s}`)}}const d=n.computed;n.customRef,n.defineAsyncComponent,n.defineComponent,n.effectScope,n.getCurrentInstance,n.getCurrentScope,n.h,n.inject,n.isProxy,n.isReactive,n.isReadonly,n.isRef,n.isShallow,n.markRaw,n.nextTick,n.onActivated,n.onBeforeMount,n.onBeforeUnmount,n.onBeforeUpdate,n.onDeactivated,n.onErrorCaptured;const C=n.onMounted;n.onRenderTracked,n.onRenderTriggered,n.onScopeDispose,n.onServerPrefetch;const y=n.onUnmounted;n.onUpdated,n.provide,n.proxyRefs,n.reactive,n.readonly;const m=n.ref;n.shallowReactive,n.shallowReadonly,n.shallowRef,n.toRaw,n.toRef,n.toRefs,n.triggerRef,n.unref,n.useAttrs,n.useCssModule,n.useCssVars,n.useListeners,n.useSlots;const Z=n.watch;n.watchEffect,n.watchPostEffect,n.watchSyncEffect;const x={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number},B={__name:"heading-structure",props:x,setup(l){const e=l,t=b(),{load:s}=$(),o=m(null),p=d(()=>{var a;return(a=o.value)==null?void 0:a.some((r,u)=>{var i;return r.level>(((i=o.value[u-1])==null?void 0:i.level)??0)+1})}),f=d(()=>{var a;return((a=o.value)==null?void 0:a.filter(r=>r.level===1).length)>1}),v=d(()=>{var a;return((a=o.value)==null?void 0:a.filter(r=>r.level===1).length)===0}),_=()=>s({parent:e.parent,name:e.name}).then(a=>{o.value=a.data}),c=(a,r)=>{var u;return!!(a.level>(((u=o.value[r-1])==null?void 0:u.level)??0)+1||a.level===1&&o.value[r-1]||a.level===1&&o.value.filter(i=>i.level===1).length>1)};return C(()=>{_(),t.events.on("content.save",a=>{_()})}),y(()=>t.events.off("content.save")),{__sfc:!0,props:e,panel:t,load:s,data:o,incorrectOrder:p,multipleH1:f,noH1:v,handleLoad:_,itemInvalid:c}}};var D=function(){var e=this,t=e._self._c,s=e._self._setupProxy;return s.data?t("div",{staticClass:"k-section k-heading-structure"},[t("div",{staticClass:"k-field-header k-heading-structure__label k-label k-field-label"},[t("k-icon",{attrs:{type:"headline"}}),t("span",{staticClass:"k-label-text"},[e._v(e._s(s.props.label||e.$t("seo.sections.headingStructure.title")))])],1),t("k-box",{attrs:{theme:"white"}},[t("ol",{staticClass:"k-heading-structure__list"},e._l(s.data,function(o,p){return t("li",{key:p,class:`k-heading-structure__item level-${o.level} ${s.itemInvalid(o,p)?"is-invalid":""}`,style:`z-index: ${s.data.length-p}`},[t("span",{staticClass:"k-heading-structure__item__level"},[e._v(" H"+e._s(o.level)+" ")]),t("span",{staticClass:"k-heading-structure__item__text"},[e._v(e._s(o.text))])])}),0)]),s.incorrectOrder&&!s.noH1?t("k-box",{staticClass:"k-heading-structure__notice",attrs:{theme:"negative"}},[t("k-icon",{attrs:{type:"alert"}}),t("k-text",[e._v(e._s(e.$t("seo.sections.headingStructure.errors.incorrectOrder")))])],1):e._e(),s.multipleH1?t("k-box",{staticClass:"k-heading-structure__notice",attrs:{theme:"negative"}},[t("k-icon",{attrs:{type:"alert"}}),t("k-text",[e._v(e._s(e.$t("seo.sections.headingStructure.errors.multipleH1")))])],1):e._e(),s.noH1?t("k-box",{staticClass:"k-heading-structure__notice",attrs:{theme:"negative"}},[t("k-icon",{attrs:{type:"alert"}}),t("k-text",[e._v(e._s(e.$t("seo.sections.headingStructure.errors.missingH1")))])],1):e._e()],1):e._e()},O=[],z=g(B,D,O);const E=z.exports,j={__name:"facebook-preview",props:{ogTitle:String,url:String,ogDescription:String,ogImage:String},setup(l){const e=l,t=d(()=>new window.URL(e.url).host);return{__sfc:!0,props:e,host:t}}};var G=function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",[t("div",{staticClass:"k-facebook-preview"},[e.ogImage?t("div",{staticClass:"k-facebook-preview__image"},[t("img",{staticClass:"k-facebook-preview__img",attrs:{src:e.ogImage}})]):e._e(),t("div",{staticClass:"k-facebook-preview__content"},[t("span",{staticClass:"k-facebook-preview__url"},[e._v(e._s(s.host))]),t("span",{staticClass:"k-facebook-preview__title"},[e._v(e._s(e.ogTitle))]),t("p",{staticClass:"k-facebook-preview__description"},[e._v(e._s(e.ogDescription))])])]),t("a",{staticClass:"k-seo-preview__debugger",attrs:{href:"https://developers.facebook.com/tools/debug/","aria-label":"Facebook Sharing Debugger",target:"_blank",rel:"noopener noreferrer"}},[e._v(" "+e._s(e.$t("seo.sections.preview.openDebugger"))+" "),t("k-icon",{attrs:{type:"open"}})],1)])},W=[],q=g(j,G,W);const K=q.exports,J={__name:"google-preview",props:{title:String,url:String,description:String,ogSiteName:String},setup(l){const e=l,t=d(()=>new window.URL(e.url).origin),s=d(()=>new window.URL(e.url).pathname),o=d(()=>new window.URL(e.url).hostname),p=d(()=>{const f=s.value;if(!f||f==="/")return"";const v=f.split("/").filter(Boolean);return v.length===0?"":v.length===1?` › ${v[0]}`:` › … › ${v[v.length-1]}`});return{__sfc:!0,props:e,origin:t,pathname:s,domain:o,breadcrumbs:p}}};var Q=function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",[t("div",{staticClass:"k-google-search-preview"},[t("div",{staticClass:"k-google-search-preview__header"},[t("img",{staticClass:"k-google-search-preview__favicon",attrs:{src:`https://www.google.com/s2/favicons?domain=${s.domain.value}&sz=32`,alt:`${e.ogSiteName} favicon`}}),t("div",{staticClass:"k-google-search-preview__site-info"},[t("span",{staticClass:"k-google-search-preview__site-title"},[e._v(e._s(e.ogSiteName))]),t("span",{staticClass:"k-google-search-preview__url"},[e._v(" "+e._s(s.origin)+e._s(s.breadcrumbs)+" ")])])]),t("h3",{staticClass:"k-google-search-preview__title"},[e._v(e._s(e.title))]),e.description?t("p",{staticClass:"k-google-search-preview__description"},[e._v(" "+e._s(e.description)+" ")]):e._e()]),t("a",{staticClass:"k-seo-preview__debugger",attrs:{href:"https://search.google.com/search-console","aria-label":"Google Search Console",target:"_blank",rel:"noopener noreferrer"}},[e._v(" "+e._s(e.$t("seo.sections.preview.openSearchConsole"))+" "),t("k-icon",{attrs:{type:"open"}})],1)])},X=[],Y=g(J,Q,X);const ee=Y.exports,te={__name:"slack-preview",props:{ogTitle:String,ogSiteName:String,ogDescription:String,ogImage:String,url:String},setup(l){const e=l,t=d(()=>new window.URL(e.url).origin),s=d(()=>new window.URL(e.url).hostname),o=m(!0);return{__sfc:!0,props:e,origin:t,domain:s,showImage:o}}};var se=function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"k-slack-preview"},[t("div",{staticClass:"k-slack-preview__content"},[t("div",{staticClass:"k-slack-preview__site-name"},[t("img",{staticClass:"k-slack-preview__favicon",attrs:{src:`https://www.google.com/s2/favicons?domain=${s.domain}&sz=16`,alt:`${e.ogSiteName} favicon`}}),e._v(" "+e._s(e.ogSiteName||s.origin)+" ")]),t("span",{staticClass:"k-slack-preview__title"},[e._v(e._s(e.ogTitle))]),t("p",{staticClass:"k-slack-preview__description"},[e._v(" "+e._s(e.ogDescription)+" "),e.ogImage?t("button",{staticClass:"k-slack-preview__image-toggle",on:{click:function(o){s.showImage=!s.showImage}}},[e._v(" "+e._s(s.showImage?"▼":"▶")+" ")]):e._e()])]),e.ogImage&&s.showImage?t("div",{staticClass:"k-slack-preview__image"},[t("img",{attrs:{src:e.ogImage}})]):e._e()])},ne=[],oe=g(te,se,ne);const ae=oe.exports,re={__name:"seo-preview",props:x,setup(l){const e=l,t=b(),s=A(),{load:o}=$(),p=m(null),f=m([]),v=d(()=>e.parent==="site"),_=d(()=>{var i;return e.label||((i=t==null?void 0:t.t)==null?void 0:i.call(t,"seo.sections.preview.title"))||"Preview"}),c=d(()=>{var h;const i=(h=p.value)==null?void 0:h.pageTitle;if(v.value&&i){const S=i.replaceAll('"','\\"');return`${_.value} (shows "${S}")`}return _.value}),a=m(window.localStorage.getItem("kSEOPreviewType")??"google");Z(a,i=>{window.localStorage.setItem("kSEOPreviewType",i)});const r=()=>{o({parent:e.parent,name:e.name}).then(i=>{p.value=i.meta,f.value=i.options,!window.localStorage.getItem("kSEOPreviewType")&&i.options.length>0&&(a.value=i.options[0].value)})},u=()=>{var i;(i=p.value)!=null&&i.panelUrl&&s.$go(p.value.panelUrl)};return C(()=>{r(),t.events.on("content.save",i=>{r()})}),y(()=>t.events.off("content.save")),{__sfc:!0,props:e,panel:t,app:s,load:o,meta:p,options:f,isSiteParent:v,baseLabel:_,headerLabel:c,type:a,handleLoad:r,openPanelTarget:u,FacebookPreview:K,GooglePreview:ee,SlackPreview:ae}}};var ie=function(){var o;var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"k-section k-seo-preview"},[t("div",{staticClass:"k-field-header k-seo-preview__label k-label k-field-label"},[t("k-icon",{attrs:{type:"preview"}}),t("span",{staticClass:"k-label-text"},[e._v(" "+e._s(s.headerLabel)+" ")]),s.isSiteParent&&((o=s.meta)!=null&&o.panelUrl)?t("k-button",{staticClass:"k-seo-preview__panel-button",attrs:{variant:"filled",size:"xs",icon:"edit"},on:{click:s.openPanelTarget}},[e._v(" View page in panel ")]):e._e()],1),t("k-select-field",{attrs:{type:"select",name:"seo-preview-type",before:e.$t("seo.sections.preview.showFor"),options:s.options,required:!0,empty:!1},model:{value:s.type,callback:function(p){s.type=p},expression:"type"}}),s.meta?t("div",{staticClass:"k-seo-preview__inner"},[s.type==="google"?t(s.GooglePreview,e._b({},"google-preview",s.meta,!1)):e._e(),s.type==="facebook"?t(s.FacebookPreview,e._b({},"facebook-preview",s.meta,!1)):e._e(),s.type==="slack"?t(s.SlackPreview,e._b({},"slack-preview",s.meta,!1)):e._e()],1):e._e()],1)},le=[],ce=g(re,ie,le);const _e=ce.exports,pe=(l,e)=>()=>{var s,o;const t=(o=(s=window.panel)==null?void 0:s.$t)==null?void 0:o.call(s,l);return t&&t!==l?t:e},T=({name:l,icon:e,variable:t,labelKey:s,fallbackLabel:o,theme:p="blue"})=>{const f=pe(s,o);class v{constructor(c,a,r){this.node=c,this.view=a,this.getPos=r;const u=document.createElement("span");u.classList.add("k-seo-template-variable"),u.setAttribute("contenteditable","false"),u.dataset.theme=p,this.dom=u,this.render()}render(){const c=f();this.dom.dataset.seoTemplateVariable=this.node.attrs.variable,this.dom.dataset.theme=p,this.dom.textContent=c,this.updateSelectionHighlight()}update(c){return this.node=c,this.render(),!0}updateSelectionHighlight(){const c=this.view.state.selection;let a=(c==null?void 0:c.node)===this.node;if(!a&&typeof this.getPos=="function"){const r=this.getPos();if(typeof r=="number"){if(c!=null&&c.empty)a=c.from===r||c.from===r+this.node.nodeSize;else if(c){const u=r,i=r+this.node.nodeSize;a=c.from<=u&&c.to>=i}}}this.dom.classList.toggle("is-selected",!!a)}ignoreMutation(){return!0}stopEvent(){return!0}selectNode(){this.dom.classList.add("is-selected")}deselectNode(){this.dom.classList.remove("is-selected")}}return{get button(){return{id:this.name,icon:this.icon,label:f(),name:this.name,inline:!0}},get icon(){return e},get name(){return l},commands({type:_}){return()=>(c,a)=>{if(!a)return!1;const{tr:r,selection:u}=c,i=u.$from.pos,h=_.create({variable:t});r.replaceSelectionWith(h);const S=c.selection.constructor,R=k=>k===" "||k===" "||k===`
`;let P=!1;if(i>0){const k=r.doc.textBetween(i-1,i,`
`,`
`);R(k)||(r.insertText(" ",i),P=!0)}let w=i+(P?1:0)+h.nodeSize;const ue=r.doc.textBetween(w,w+1,`
`,`
`);R(ue)||(r.insertText(" ",w),w+=1);const de=w;return r.setSelection(S.near(r.doc.resolve(de))),a(r.scrollIntoView()),!0}},get schema(){return{group:"inline",inline:!0,atom:!0,leafText:_=>`{{ ${_.attrs.variable} }}`,attrs:{variable:{default:t}},parseDOM:[{tag:`span[data-seo-template-variable="${t}"]`,getAttrs:_=>({variable:_.dataset.seoTemplateVariable??t})}],toDOM:_=>["span",{"data-seo-template-variable":_.attrs.variable},`{{ ${_.attrs.variable} }}`]}},view(_,c,a){return new v(_,c,a)}}};panel.plugin("tobimori/seo",{icons:{robots:'<path d="M13.5 2c0 .444-.193.843-.5 1.118V5h5a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h5V3.118A1.5 1.5 0 1 1 13.5 2ZM6 7a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H6Zm-4 3H0v6h2v-6Zm20 0h2v6h-2v-6ZM9 14.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm6 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" />',"robots-off":'<path fill-rule="evenodd" clip-rule="evenodd" d="M21 16.786V8a3 3 0 0 0-3-3h-5V3.118a1.5 1.5 0 1 0-2 0V5H9.214l2 2H18a1 1 0 0 1 1 1v6.786l2 2ZM2.093 3.507l2.099 2.099A2.995 2.995 0 0 0 3 8v10a3 3 0 0 0 3 3h12c.463 0 .902-.105 1.293-.292l1.9 1.9 1.414-1.415-6.88-6.88a1.5 1.5 0 1 0-2.04-2.04L3.508 2.093 2.093 3.507ZM5 8a1 1 0 0 1 .65-.937L17.585 19H6a1 1 0 0 1-1-1V8Zm-5 2h2v6H0v-6Zm24 0h-2v6h2v-6Zm-13.5 3a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />'},sections:{"heading-structure":E,"seo-preview":_e},fields:{"seo-writer":N},components:{"k-seo-writer-input":M},writerNodes:{seoTemplateTitle:T({name:"seoTemplateTitle",icon:"page",variable:"title",labelKey:"seo.writerNodes.template.title",fallbackLabel:"{{ title }}",theme:"blue"}),seoTemplateSiteTitle:T({name:"seoTemplateSiteTitle",icon:"globe",variable:"site.title",labelKey:"seo.writerNodes.template.siteTitle",fallbackLabel:"{{ site.title }}",theme:"purple"})}})})();
